<?xml version="1.0" ?>

<container xmlns="http://www.symfony-project.org/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.symfony-project.org/schema/dic/services http://www.symfony-project.org/schema/dic/services/services-1.0.xsd">

    <parameters>
        
        <parameter key="imageresizer.cache.mongo.class">Bundle\Adenclassifieds\ImageResizerBundle\Cache\MongoCache</parameter>
        <parameter key="imageresizer.cache.memcache.class">Doctrine\Common\Cache\MemcacheCache</parameter>
        <parameter key="imageresizer.loader.class">Bundle\Adenclassifieds\ImageResizerBundle\Image\Loader</parameter>
        <parameter key="imageresizer.loader.base_directory">/tmp</parameter>
        <parameter key="imageresizer.processor.class">Bundle\Adenclassifieds\ImageResizerBundle\Image\Processor</parameter>
        <parameter key="imageresizer.class">Bundle\Adenclassifieds\ImageResizerBundle\Image\Resizer</parameter>
        <parameter key="imageresizer.functions" type="collection">
            <parameter>cropCenter</parameter>
            <parameter>homothetic</parameter>
            <parameter>adaptive</parameter>
        </parameter>
        <parameter key="imageresizer.sizes" type="collection">
            <parameter type="collection" key="small">
                <parameter>32</parameter>
                <parameter>32</parameter>
            </parameter>
        </parameter>
    </parameters>

    <services>
        <service id="imageresizer.cache.mongo" class="%imageresizer.cache.mongo.class%">
            <call method="setMongo">
              <argument type="service">
                  <service class="Mongo">
                      <call method="connect">
                          <argument>mongodb://localhost</argument>
                          <argument>11211</argument>
                      </call>
                  </service>
              </argument>
              <argument>imageresizer</argument>
              <argument>files</argument>
            </call>
        </service>
        <service id="imageresizer.cache.memcache" class="%imageresizer.cache.memcache.class%">
            <call method="setMemcache">
	            <argument type="service">
	                <service class="Memcache">
	                    <call method="connect">
	                        <argument>localhost</argument>
	                        <argument>11211</argument>
	                    </call>
	                </service>
	            </argument>
            </call>
        </service>
        <service id="imageresizer.loader" class="%imageresizer.loader.class%">
            <argument type="service">
                <service class="Imagick" shared="false" />
            </argument> 
            <argument type="service" id="imageresizer.cache.memcache" />
            <argument>%imageresizer.loader.base_directory%</argument>
        </service>
        <service id="imageresizer.processor" class="%imageresizer.processor.class%">
        </service>
        <service id="imageresizer" class="%imageresizer.class%">
            <argument type="service" id="imageresizer.loader" />
            <argument type="service" id="imageresizer.processor" />
            <argument>%imageresizer.sizes%</argument>
            <argument>%imageresizer.functions%</argument>
        </service>
    </services>
</container>
